# ============================================
# Archivo: k8s/ingress/ingress-space.yaml
# OPCIÓN SIN PREFIJO - Acceso directo en localhost/
# ============================================
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: space-ingress
  namespace: socialbeats
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    # Timeouts para requests largos
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "500"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "500"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "500"
    # Tamaño máximo del body
    nginx.ingress.kubernetes.io/proxy-body-size: "100m"
    # Buffer sizes
    nginx.ingress.kubernetes.io/client-header-buffer-size: "64k"
    nginx.ingress.kubernetes.io/large-client-header-buffers: "8 64k"
    # Soporte para WebSockets
    nginx.ingress.kubernetes.io/proxy-http-version: "1.1"
    nginx.ingress.kubernetes.io/websocket-services: "space-server"
spec:
  ingressClassName: nginx
  rules:
    - host: localhost
      http:
        paths:
          # Rutas API - Backend (space-server)
          - path: /api
            pathType: Prefix
            backend:
              service:
                name: space-server
                port:
                  number: 3000
          
          # Rutas WebSocket - Backend (space-server)
          - path: /events
            pathType: Prefix
            backend:
              service:
                name: space-server
                port:
                  number: 3000
          
          # Todo lo demás - Frontend (space-client)
          - path: /
            pathType: Prefix
            backend:
              service:
                name: space-client
                port:
                  number: 5050
